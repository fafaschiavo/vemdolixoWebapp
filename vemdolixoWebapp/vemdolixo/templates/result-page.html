{% extends "generic-page.html" %}

{% block style %}
<style type="text/css">
    .mdl-shadow--2dp{
      width: 100%;
      height: 20vh;
      margin-bottom: 20px;
    }
    .page .title-page span{
      color: #b3b3b3
    }
    .mdl-card__title{
      padding-bottom: 0px;
      padding-top: 1vh;
    }
    .mdl-card__title-text{
      font-size: 20px;
    }
    .mdl-card__supporting-text{
      padding-right: 0px;
      margin-right: 0px;
      width: 100%;
      font-size: 0.9rem;
    }
    .mdl-card__supporting-text div{
      word-break: break-all;
      margin-bottom: 2px;
    }
    .mdl-dialog{
      width: 450px;
    }
    .mdl-dialog__title{
      font-size: 20px;
    }
    .mdl-dialog{
      padding: 0px;
    }
    .mdl-dialog__title{
      background: #323a45;
      color: #fff;
      padding-top: 16px;
      padding-bottom: 16px;
      text-align: center;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .dialog-explanation{
      text-align: center;
    }
    .dialog-cancel{
      text-align: center;
      margin-top: 10px;
    }
    .dialog-input{
      background-color: #e3e8ee;
      padding: 5px;
    }
    .mdl-textfield__input{
      height: 38px;
    }
    .mdl-button--raised.mdl-button--colored{
      background: #9bc43e;
      margin-top: 0px;
      color: #fff;
    }
    .close{
      float: none;
    }
    .firefox-dialog{
      width: 400px;
      margin: 4vw auto auto;
      margin-top: 4vw;
      position: absolute;
      top: 10%;
      left: 33%;
      z-index: 100;
      background: #fff;
      box-shadow: 0 9px 46px 8px rgba(0,0,0,.14),0 11px 15px -7px rgba(0,0,0,.12),0 24px 38px 3px rgba(0,0,0,.2);
    }
    @media (max-width: 600px) {
      .firefox-dialog{
        width: 82%;
        top: 3.4%;
        left: 8%;
      }
      .company-logo{
        display: none;
      }
      .page-first-title{
        font-size: 24px !important;
      }
      .mdl-dialog{
        width: 90%;
      }
      .mdl-button--raised.mdl-button--colored{
        font-size: 0.9rem
      }
   }
</style>
{% endblock %}


{% block content %}

<dialog class="mdl-dialog">
  <div class="" id="firefox-dialog-div">
    <h4 class="mdl-dialog__title">ENCONTRAMOS!</h4>
    <div class="mdl-dialog__content">
      <p class="dialog-explanation">
        Para acessar as informações digite seu email:
      </p>

      <!-- Simple Textfield -->
      <form action="{% url 'simple_register_create' %}" style="width: 70%; margin: auto;" method="get" id="register-form">
        <div class="mdl-textfield mdl-js-textfield">
          <input class="mdl-textfield__input dialog-input" type="email" name="contact_email" id="contact_email" placeholder="Email...">
        </div>
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="submit-generic-registration">
          Enviar
        </button>
        <div class="dialog-cancel">
          <button type="button" class="mdl-button close">Cancelar</button>
        </div>
      </form>

    </div>
  </div>
</dialog>

<div class="container">

  <!-- title page -->
  <div class="header-spacing title-page clearfix">
    <span class="page-first-title" style="line-height: initial;">Locais de destinação de Resíduos eletroeletrônicos</span>
  <!--                 <h2>
      Nosso Time 
    </h2> -->
  <!--                 <div class="devider-top"></div> -->
    <div style="height: 10vh;"></div>
    <div class="devider-bottom-title"></div>
  </div><!-- end title page -->

  <!-- team -->
  <div class="row" id="info-container">
    <div class="col-md-5 col-sm-4 side-section side-section-left">


      <div class="demo-card-wide mdl-card mdl-shadow--2dp">
        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--7-col">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">{{ name1 }}</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <div><i class="fa fa-phone" aria-hidden="true"></i> - {{ tel1 }}</div>
              <div><i class="fa fa-map-marker" aria-hidden="true"></i> - {{ address1 }}</div>
              <div style="font-size: 0.84rem;"><i class="fa fa-envelope" aria-hidden="true"></i> - {{ email1 }}</div>
              <div style="font-size: 0.84rem;"><i class="fa fa-globe" aria-hidden="true"></i> - <a href="{{ site1_url }}" target="_blank" id="website-1">{{ site1 }}</a></div>
            </div>
          </div>
          <div class="mdl-cell mdl-cell--5-col">
            <img src="https://s3-sa-east-1.amazonaws.com/residoando/sample.jpg" style="max-width: 100%;" class="company-logo">
          </div>
        </div>
        <div class="mdl-card__menu">
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ site1_url }}" target="_blank">
            <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
              <i class="material-icons">share</i>
            </button>
          </a>
        </div>
      </div>

      <div class="demo-card-wide mdl-card mdl-shadow--2dp">
        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--7-col">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">{{ name2 }}</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <div><i class="fa fa-phone" aria-hidden="true"></i> - {{ tel2 }}</div>
              <div><i class="fa fa-map-marker" aria-hidden="true"></i> - {{ address2 }}</div>
              <div style="font-size: 0.84rem;"><i class="fa fa-envelope" aria-hidden="true"></i> - {{ email2 }}</div>
              <div style="font-size: 0.84rem;"><i class="fa fa-globe" aria-hidden="true"></i> - <a href="{{ site2_url }}" target="_blank" id="website-2">{{ site2 }}</a></div>
            </div>
          </div>
          <div class="mdl-cell mdl-cell--5-col">
            <img src="https://s3-sa-east-1.amazonaws.com/residoando/sample.jpg" style="max-width: 100%;" class="company-logo">
          </div>
        </div>
        <div class="mdl-card__menu">
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ site2_url }}" target="_blank">
            <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
              <i class="material-icons">share</i>
            </button>
          </a>
        </div>
      </div>

      <div class="demo-card-wide mdl-card mdl-shadow--2dp">
        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--7-col">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">{{ name3 }}</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <div><i class="fa fa-phone" aria-hidden="true"></i> - {{ tel3 }}</div>
              <div><i class="fa fa-map-marker" aria-hidden="true"></i> - {{ address3 }}</div>
              <div style="font-size: 0.84rem;"><i class="fa fa-envelope" aria-hidden="true"></i> - {{ email3 }}</div>
              <div style="font-size: 0.84rem;"><i class="fa fa-globe" aria-hidden="true"></i> - <a href="{{ site3_url }}" target="_blank" id="website-3">{{ site3 }}</a></div>
            </div>
          </div>
          <div class="mdl-cell mdl-cell--5-col">
            <img src="https://s3-sa-east-1.amazonaws.com/residoando/sample.jpg" style="max-width: 100%;" class="company-logo">
          </div>
        </div>
        <div class="mdl-card__menu">
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ site3_url }}" target="_blank">
            <button class="mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect">
              <i class="material-icons">share</i>
            </button>
          </a>
        </div>
      </div>

    </div>
    <div class="col-md-7 col-sm-4 side-section side-section-right">
      <div id="map-result" style="width: 100%; height: 72vh;"></div>
    </div>
  </div><!-- end team -->

  <div class="white-space-20"></div>
</div>
{% endblock %}


{% block script %}

<script type="text/javascript">
  $('#contact').css("display", "none");

  var content_height = $("#info-container").height();
  var section_height = $("#main-content").height();
    if (content_height + 350 > section_height) {
      content_height = content_height + 350
      section_height = $("#main-content").height(content_height + 'px');
    }
</script>

<script>
  function initMap() {
    var myLatLng = {lat: {{ lat_original }}, lng: {{ lon_original }}};
    var bounds = new google.maps.LatLngBounds();

    loc = new google.maps.LatLng("{{ lat_original }}","{{ lon_original }}");
    bounds.extend(loc);

      var styleArray = [
        {
          featureType: 'all',
          stylers: [
            { saturation: -50 }
          ]
        },{
          featureType: 'road.arterial',
          elementType: 'geometry',
          stylers: [
            { hue: '#00ffee' },
            { saturation: 50 }
          ]
        },{
          featureType: 'poi.business',
          elementType: 'labels',
          stylers: [
            { visibility: 'off' }
          ]
        }
      ];

    // Create a map object and specify the DOM element for display.
    var map = new google.maps.Map(document.getElementById('map-result'), {
      scrollwheel: true,
      styles: styleArray
    });

    // Create a marker and set its position.
    var marker = new google.maps.Marker({
      map: map,
      position: myLatLng,
      title: 'Meu local',
    });

    // marker 1 + info window 1 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

    var contentString1 = '<strong> {{ name1 }} </strong> <br> <div> {{ address1 }} </div> <div> {{ tel1 }} </div>';

    loc = new google.maps.LatLng("{{ lat1 }}","{{ lon1 }}");
    bounds.extend(loc);

    var infowindow1 = new google.maps.InfoWindow({
      content: contentString1
    });

    var marker1 = new google.maps.Marker({
      map: map,
      position: {lat: {{ lat1 }}, lng: {{ lon1 }}},
      title: '{{ name1 }}',
      icon: 'https://s3-sa-east-1.amazonaws.com/residoando/icon-1.png'
    });

    marker1.addListener('click', function() {
      infowindow1.open(map, marker1);
    });

    // marker 2 + info window 2 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

    var contentString2 = '<strong> {{ name2 }} </strong> <br> <div> {{ address2 }} </div> <div> {{ tel2 }} </div>';

    loc = new google.maps.LatLng("{{ lat2 }}","{{ lon2 }}");
    bounds.extend(loc);

    var infowindow2 = new google.maps.InfoWindow({
      content: contentString2
    });

    var marker2 = new google.maps.Marker({
      map: map,
      position: {lat: {{ lat2 }}, lng: {{ lon2 }}},
      title: '{{ name2 }}',
      icon: 'https://s3-sa-east-1.amazonaws.com/residoando/icon-1.png'
    });

    marker2.addListener('click', function() {
      infowindow2.open(map, marker2);
    });

    // marker 3 + info window 3 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 

    var contentString3 = '<strong> {{ name3 }} </strong> <br> <div> {{ address3 }} </div> <div> {{ tel3 }} </div>';

    loc = new google.maps.LatLng("{{ lat3 }}","{{ lon3 }}");
    bounds.extend(loc);

    var infowindow3 = new google.maps.InfoWindow({
      content: contentString3
    });

    var marker3 = new google.maps.Marker({
      map: map,
      position: {lat: {{ lat3 }}, lng: {{ lon3 }}},
      title: '{{ name3 }}',
      icon: 'https://s3-sa-east-1.amazonaws.com/residoando/icon-1.png'
    });

    marker3.addListener('click', function() {
      infowindow3.open(map, marker3);
    });

    map.fitBounds(bounds);
    map.panToBounds(bounds);

  }

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBhx18jDGJ7H-ywCkTk_3c29u9uOgEzFi8&callback=initMap" async defer></script>

<script>
var map;
var markersArray = [];
var image = 'img/';
var bounds = new google.maps.LatLngBounds();
var loc;

function init(){
    var mapOptions = { mapTypeId: google.maps.MapTypeId.ROADMAP };
    map =  new google.maps.Map(document.getElementById("map_canvas"), mapOptions);

    loc = new google.maps.LatLng("45.478294","9.123949");
    bounds.extend(loc);
    addMarker(loc, 'Event A', "active");

    loc = new google.maps.LatLng("50.83417876788752","4.298325777053833");
    bounds.extend(loc);
    addMarker(loc, 'Event B', "active");

    loc = new google.maps.LatLng("41.3887035","2.1807378");
    bounds.extend(loc);
    addMarker(loc, 'Event C', "active");

    map.fitBounds(bounds);
    map.panToBounds(bounds);    
}

function addMarker(location, name, active) {          
    var marker = new google.maps.Marker({
        position: location,
        map: map,
        title: name,
        status: active
    });
}

$(function(){ init(); });
</script>

<script src="http://malsup.github.com/jquery.form.js"></script>

<script type="text/javascript">
  
  if (typeof HTMLDialogElement === 'function') {
    setTimeout(function() {
      $(".container").css("filter", "blur(7px)");

      var dialog = document.querySelector('dialog');
      var showDialogButton = document.querySelector('#show-dialog');
      if (! dialog.showModal) {
        dialogPolyfill.registerDialog(dialog);
      }

      dialog.showModal();

      dialog.querySelector('.close').addEventListener('click', function() {
        $(".container").css("filter", "blur(0px)")
        dialog.close();
      });

      // bind 'myForm' and provide a simple callback function 
      $('#register-form').ajaxForm(function() { 
          var dialog = document.querySelector('dialog');
          $(".container").css("filter", "blur(0px)")
          dialog.close();
      }); 
    }, 5000);
  } else {
    $("dialog").css("display", "none");
    setTimeout(function() {
      $("dialog").css("display", "inherit");
      $(".container").css("filter", "blur(7px)");
      $("#firefox-dialog-div").addClass("firefox-dialog");
      document.getElementById("submit-generic-registration").disabled = true;

      $('#contact_email').on('input', function() { 
          var email = $("#contact_email").val();

          if (email.length > 4 && email.indexOf('@') !== -1 && email.indexOf('.') !== -1) {
            document.getElementById("submit-generic-registration").disabled = false;
          }else{
            document.getElementById("submit-generic-registration").disabled = true;
          }
      });

      $(".close").click(function(){
          $(".container").css("filter", "blur(0px)");
          $("dialog").css("display", "none");
      });

      $('#register-form').ajaxForm(function() { 
        $(".container").css("filter", "blur(0px)");
        $("dialog").css("display", "none");
      });
    }, 5000);
  }

</script>

<script type="text/javascript">
$( "#submit-generic-registration" ).click(function() {
    var new_email = $( "#contact_email" ).val()
    
    $.ajax({
        url: "{% url 'simple_register_create' %}",
        data : { contact_email : new_email},
        type: 'get',
        success: function(data) {
            console.log(data);
        },
        failure: function(data) {
            console.log('Got an error dude');
        }
    });


});
</script>
{% endblock %}